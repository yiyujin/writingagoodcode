<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Step Analysis</title>
  <link rel = "stylesheet" href = "style.css">
  <script>
    document.addEventListener("DOMContentLoaded", async function() {
      //FETCH DATA
      const response = await fetch('./sourcecode.txt');
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const sourcecode = await response.text();

      const container = document.getElementById("step-analysis");

      let txt = sourcecode.split("\n").map(line => line.trim());

      let data = [];
      let a, b, cnt;

      for(let i = 0; i < txt.length; i++){ //for all the words, 

        if(txt[i].startsWith('//')){ //if it's a match,
          data.push({
              index: i,//original line index
              content: txt[i].slice(2),
          }); 
        }
      }

      //CALCULATE DIFF (LENGTH, BAR, VOL..)
      for(let i = 0; i < data.length; i++){
        //cnt = b - a - 1 (to get numbers between a and b, excluding a and b)
        a = data[i].index;

        if(i < data.length - 1){
            b = data[i + 1].index;
        }else{ //for the last step,
            b = txt.length - 1;
        }

        cnt = b - a - 1;

        //ADD THAT TO THE ARRAY
        data[i].cnt = cnt;
      }

      // HTML
      const title = document.createElement("p");
      title.textContent = `Step Analysis (${data.length}):`;
      container.appendChild(title);

      const table = document.createElement("table");
      const headerRow = document.createElement("tr");
      const headerCell = document.createElement("th");
      headerCell.className = "meta3";
      headerCell.textContent = "lines · step name";
      headerRow.appendChild(headerCell);
      table.appendChild(headerRow);
      container.appendChild(table);

      data.forEach(item => {
        const row = document.createElement("div");
        row.className = "step-row";

        const barContainer = document.createElement("div");
        barContainer.className = "step-bar";

        const bar = document.createElement("span");
        bar.className = "bar-visual";
        bar.style.height = `${item.cnt}px`;

        const countText = document.createElement("p");
        countText.className = "meta3";
        countText.textContent = item.cnt;

        barContainer.appendChild(bar);
        barContainer.appendChild(countText);

        const stepText = document.createElement("p");
        stepText.className = "meta2";
        stepText.textContent = `· ${item.content}`;

        row.appendChild(barContainer);
        row.appendChild(stepText);

        container.appendChild(row);
      });

    });
  </script>
</head>
<body>
  <div id = "step-analysis"></div>
</body>
</html>